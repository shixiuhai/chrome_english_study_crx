# Chrome è‹±è¯­å•è¯å­¦ä¹ æ’ä»¶

## åŠŸèƒ½æ¦‚è¿°
1. **æ™ºèƒ½å•è¯æ ‡è®°**
   - åˆ’é€‰ç½‘é¡µä»»æ„è‹±æ–‡å•è¯/è¯ç»„è‡ªåŠ¨æ·»åŠ è“è‰²ä¸‹åˆ’çº¿æ ‡è®°
   - æ”¯æŒè¯ç»„å’Œå¤šå•è¯æ ‡è®°
   - è‡ªåŠ¨è·³è¿‡å‰åç©ºæ ¼
   - 300mså»¶è¿Ÿç¡®è®¤æœºåˆ¶ï¼Œé¿å…è¯¯æ“ä½œ
   - æ”¯æŒESCé”®å–æ¶ˆæ ‡è®°

2. **å®æ—¶ç¿»è¯‘ä¸éŸ³æ ‡**
   - é¼ æ ‡æ‚¬åœæ ‡è®°æ˜¾ç¤ºç°ä»£åŒ–æ¸å˜å¼¹çª—
   - å…ˆåˆ’çº¿åç¿»è¯‘ï¼Œæå‡ç”¨æˆ·ä½“éªŒ
   - æ˜¾ç¤º"æ­£åœ¨ç¿»è¯‘..."ä¸´æ—¶æç¤º
   - è‡ªåŠ¨è·å–å•è¯éŸ³æ ‡å’Œå‘éŸ³

3. **æ ‡è®°åŒæ­¥**
   - æ ‡è®°ä¸€ä¸ªå•è¯ï¼Œé¡µé¢æ‰€æœ‰ç›¸åŒå†…å®¹è‡ªåŠ¨æ ‡è®°
   - å–æ¶ˆä¸€ä¸ªæ ‡è®°ï¼Œé¡µé¢æ‰€æœ‰ç›¸åŒæ ‡è®°è‡ªåŠ¨ç§»é™¤
   - å•è¯æœ¬ä¸æ ‡è®°åŒæ­¥æ›´æ–°

4. **å•è¯æœ¬ç®¡ç†**
   - æŸ¥çœ‹æ‰€æœ‰å·²æ ‡è®°å•è¯å’Œè¯ç»„
   - ç¼–è¾‘å•è¯ç¿»è¯‘å’ŒéŸ³æ ‡
   - åˆ é™¤ä¸éœ€è¦çš„å•è¯
   - æœç´¢å•è¯åŠŸèƒ½ï¼ˆæœç´¢æ¡†ä½äºå•è¯åˆ—è¡¨ä¸Šæ–¹ï¼‰
   - è‡ªåŠ¨è®°å½•æ·»åŠ /å¤ä¹ æ—¶é—´

5. **æ•°æ®æŒä¹…åŒ–**
   - é¡µé¢åˆ·æ–°åè‡ªåŠ¨æ¢å¤æ ‡è®°
   - æ‰€æœ‰æ•°æ®æœ¬åœ°å­˜å‚¨
   - ç»Ÿä¸€é…ç½®ç®¡ç†ï¼ˆAPIè·¯å¾„ç­‰ï¼‰

6. **å¤šç«¯åŒæ­¥**
   - æ”¯æŒå•è¯æœ¬ä¸Šä¼ åˆ°äº‘ç«¯
   - æ”¯æŒä»äº‘ç«¯ä¸‹è½½æœ€æ–°å•è¯æœ¬
   - åŸºäºæ—¶é—´æˆ³çš„ç‰ˆæœ¬æ§åˆ¶
   - è‡ªåŠ¨æ£€æŸ¥æœ€æ–°ç‰ˆæœ¬ï¼Œé¿å…é‡å¤æ›´æ–°
   - æ”¯æŒå¤šè®¾å¤‡æ•°æ®åŒæ­¥ä¸€è‡´æ€§

7. **åŸŸåæ’é™¤åŠŸèƒ½**
   - æ”¯æŒæ’é™¤å½“å‰åŸŸåï¼Œæ’ä»¶å°†ä¸å†åœ¨æ­¤åŸŸåä¸Šè¿è¡Œ
   - å¯ç®¡ç†å·²æ’é™¤çš„åŸŸååˆ—è¡¨
   - é»˜è®¤éšè—åœ¨é«˜çº§é…ç½®ä¸­ï¼Œå‡å°‘è§†è§‰å¹²æ‰°

8. **ç°ä»£åŒ–UIè®¾è®¡**
   - å…¨æ–°çš„ç°ä»£åŒ–UIè®¾è®¡ï¼Œä½¿ç”¨CSSå˜é‡ç»Ÿä¸€ç®¡ç†æ ·å¼
   - å“åº”å¼å¸ƒå±€ï¼Œé€‚é…ä¸åŒå±å¹•å°ºå¯¸
   - å¯æŠ˜å çš„é«˜çº§é…ç½®é¢æ¿
   - ä¼˜åŒ–çš„å•è¯å¡ç‰‡è®¾è®¡ï¼Œæä¾›æ›´å¥½çš„äº¤äº’ä½“éªŒ
   - è‡ªå®šä¹‰æ»šåŠ¨æ¡ï¼Œæå‡è§†è§‰æ•ˆæœ

## ä½¿ç”¨è¯´æ˜

### å®‰è£…ä¸åŠ è½½
1. åœ¨Chromeåœ°å€æ è¾“å…¥ï¼š`chrome://extensions/`
2. å¯ç”¨"å¼€å‘è€…æ¨¡å¼"
3. ç‚¹å‡»"åŠ è½½å·²è§£å‹çš„æ‰©å±•ç¨‹åº"
4. é€‰æ‹©æ’ä»¶ç›®å½•

### åŸºæœ¬ä½¿ç”¨
1. **æ ‡è®°å•è¯**ï¼šåœ¨ä»»æ„ç½‘é¡µåˆ’é€‰è‹±æ–‡å•è¯/è¯ç»„
2. **æŸ¥çœ‹ç¿»è¯‘**ï¼šé¼ æ ‡æ‚¬åœæ ‡è®°å•è¯ï¼ˆæ˜¾ç¤ºéŸ³æ ‡ï¼‰
3. **ç®¡ç†å•è¯æœ¬**ï¼šç‚¹å‡»æµè§ˆå™¨å·¥å…·æ æ’ä»¶å›¾æ ‡
   - æœç´¢ï¼šåœ¨å•è¯åˆ—è¡¨ä¸Šæ–¹çš„æœç´¢æ¡†ä¸­è¾“å…¥å…³é”®è¯å®æ—¶ç­›é€‰
   - ç¼–è¾‘ï¼šç‚¹å‡»å•è¯å¡ç‰‡çš„âœï¸æŒ‰é’®ï¼ˆå¯æ›´æ–°éŸ³æ ‡ï¼‰
   - åˆ é™¤ï¼šç‚¹å‡»å•è¯å¡ç‰‡çš„ğŸ—‘ï¸æŒ‰é’®
   - æ’­æ”¾å‘éŸ³ï¼šç‚¹å‡»å•è¯å¡ç‰‡çš„ğŸ”ŠæŒ‰é’®

### é«˜çº§é…ç½®
1. **ç”¨æˆ·IDé…ç½®**ï¼š
   - åœ¨é¡¶éƒ¨é…ç½®åŒºè¾“å…¥ç”¨æˆ·ID
   - ç‚¹å‡»"ä¿å­˜"æŒ‰é’®ä¿å­˜é…ç½®
   - ç‚¹å‡»"æ¸…é™¤"æŒ‰é’®æ¸…é™¤å½“å‰é…ç½®
   - å¯åœ¨é…ç½®ä¸‹æ–¹çœ‹åˆ°"ç”¨æˆ·IDç”¨äºå¤šè®¾å¤‡åŒæ­¥ï¼Œå»ºè®®ä½¿ç”¨å›ºå®šID"çš„æç¤º

2. **åŒæ­¥åŠŸèƒ½**ï¼š
   - ç‚¹å‡»"â¬‡ï¸ æ‹‰å–"ä»äº‘ç«¯ä¸‹è½½æœ€æ–°å•è¯æœ¬
   - ç‚¹å‡»"â¬†ï¸ åŒæ­¥"å°†æœ¬åœ°å•è¯æœ¬ä¸Šä¼ åˆ°äº‘ç«¯
   - ç‚¹å‡»"ğŸ—‘ï¸ åˆ é™¤"åˆ é™¤è¿œç¨‹å•è¯æœ¬

3. **åŸŸåæ’é™¤åŠŸèƒ½**ï¼š
   - ç‚¹å‡»"âš™ï¸ é«˜çº§é…ç½®"å±•å¼€é«˜çº§é€‰é¡¹
   - æŸ¥çœ‹å½“å‰åŸŸå
   - ç‚¹å‡»"æ’é™¤å½“å‰åŸŸå"å°†å½“å‰åŸŸåæ·»åŠ åˆ°æ’é™¤åˆ—è¡¨
   - åœ¨å·²æ’é™¤åŸŸååˆ—è¡¨ä¸­å¯ç‚¹å‡»Ã—æŒ‰é’®ç§»é™¤æ’é™¤
   - æ’é™¤åæ’ä»¶å°†ä¸å†åœ¨æ­¤åŸŸåä¸Šè¿è¡Œ

### é«˜çº§åŠŸèƒ½
- **å¤šè®¾å¤‡åŒæ­¥**ï¼šä½¿ç”¨ç›¸åŒçš„ç”¨æˆ·IDåœ¨ä¸åŒè®¾å¤‡ä¸Šç™»å½•ï¼Œå¯å®ç°æ•°æ®åŒæ­¥
- **APIè‡ªåŠ¨é‡è¯•**ï¼šç½‘ç»œè¯·æ±‚å¤±è´¥æ—¶è‡ªåŠ¨é‡è¯•ï¼Œæé«˜ç¨³å®šæ€§
- **æ€§èƒ½ä¼˜åŒ–**ï¼šä¼˜åŒ–äº†DOMæ“ä½œå’Œäº‹ä»¶å¤„ç†ï¼Œå‡å°‘æ€§èƒ½æ¶ˆè€—
- **é”™è¯¯å¤„ç†**ï¼šæ·»åŠ äº†è¾¹ç•Œæ£€æŸ¥å’Œå¼‚å¸¸æ•è·ï¼Œæé«˜æ’ä»¶ç¨³å®šæ€§

### éŸ³æ ‡åŠŸèƒ½
- è‡ªåŠ¨è·å–å•è¯è‹±å¼/ç¾å¼éŸ³æ ‡
- æ‚¬åœæ—¶æ˜¾ç¤ºæ­£ç¡®å‘éŸ³æ ‡æ³¨
- æ”¯æŒæ‰‹åŠ¨æ›´æ–°éŸ³æ ‡ä¿¡æ¯

## æŠ€æœ¯å®ç°

```mermaid
graph TD
    A[Content Script] -->|æ ‡è®°å•è¯| B(Background)
    A -->|è·å–ç¿»è¯‘å’ŒéŸ³æ ‡| B
    B -->|å­˜å‚¨æ•°æ®| C[Chrome Storage]
    D[Popup] -->|è¯»å–æ•°æ®| C
    D -->|ä¿®æ”¹æ•°æ®| B
    B -->|æ‰¹é‡éŸ³æ ‡å¤„ç†| E[Dictionary API]
    F[Config.js] -->|é…ç½®ç®¡ç†| A
    F -->|é…ç½®ç®¡ç†| B
    F -->|é…ç½®ç®¡ç†| D
```

### æ ¸å¿ƒæ–‡ä»¶
1. `manifest.json` - æ’ä»¶é…ç½®
2. `config.js` - ç»Ÿä¸€é…ç½®ç®¡ç†ï¼ˆAPIè·¯å¾„ã€æ ·å¼é…ç½®ç­‰ï¼‰
3. `content.js` - ç½‘é¡µå•è¯æ ‡è®°é€»è¾‘ï¼ˆæ”¯æŒè¯ç»„å’ŒURLæ£€æµ‹ï¼‰
4. `background.js` - æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ä¸å­˜å‚¨
5. `popup/` - å•è¯æœ¬ç•Œé¢

## é…ç½®é€‰é¡¹

### ç»Ÿä¸€é…ç½®ç®¡ç†
æ‰€æœ‰é…ç½®é¡¹é›†ä¸­åœ¨`config.js`æ–‡ä»¶ä¸­ï¼ŒåŒ…æ‹¬ï¼š
- APIåŸºç¡€URLå’Œç«¯ç‚¹
- å•è¯æ•°é‡é™åˆ¶
- æ ·å¼é…ç½®ï¼ˆé¢œè‰²ã€åŠ¨ç”»ç­‰ï¼‰
- å­˜å‚¨é”®å
- TTSé…ç½®

### é…ç½®é¡¹è¯¦æƒ…

#### APIé…ç½®
```javascript
API_BASE_URL: 'http://chrome.yizhiweb.top:8080',
ENDPOINTS: {
  TRANSLATE: '/wx/chrome/crx/translate',
  PHONETICS: '/wx/chrome/crx/phonetics',
  SYNC_UPLOAD: '/wx/chrome/crx/sync/upload',
  SYNC_DOWNLOAD: '/wx/chrome/crx/sync/download',
  SYNC_DELETE: '/wx/chrome/crx/sync/delete'
}
```

#### å•è¯æ•°é‡é™åˆ¶
```javascript
WORD_COUNT_LIMIT: 50, // å•æ¬¡é€‰ä¸­å•è¯æ•°é‡é™åˆ¶
MAX_MARKED_WORDS: 1000, // æœ€å¤§æ ‡è®°å•è¯æ•°é‡
MAX_TEXT_NODES: 2000, // æœ€å¤§å¤„ç†æ–‡æœ¬èŠ‚ç‚¹æ•°é‡
```

#### æ ·å¼é…ç½®
```javascript
STYLES: {
  MARK_COLOR: '#1e90ff',
  MARK_UNDERLINE_WIDTH: '2px',
  TOOLTIP_DELAY: 300
}
```

#### å­˜å‚¨é”®å
```javascript
STORAGE_KEYS: {
  DICTIONARY: 'word_dictionary',
  MARKS: 'word_marks',
  EXCLUDED_DOMAINS: 'excluded_domains' // æ–°å¢ï¼šåŸŸåæ’é™¤åˆ—è¡¨
}
```

#### TTSé…ç½®
```javascript
TTS_RATE: 0.9,
TTS_LANG: 'en-US'
```

### å¯è‡ªå®šä¹‰é¡¹
- `API_BASE_URL`ï¼šç¿»è¯‘å’ŒéŸ³æ ‡APIåœ°å€
- `WORD_COUNT_LIMIT`ï¼šå•æ¬¡æ ‡è®°å•è¯æ•°é‡é™åˆ¶
- `MAX_MARKED_WORDS`ï¼šæœ€å¤§æ ‡è®°å•è¯æ•°é‡
- `MAX_TEXT_NODES`ï¼šæœ€å¤§å¤„ç†æ–‡æœ¬èŠ‚ç‚¹æ•°é‡
- `STYLES.MARK_COLOR`ï¼šæ ‡è®°ä¸‹åˆ’çº¿é¢œè‰²
- `STYLES.TOOLTIP_DELAY`ï¼šæç¤ºæ¡†å»¶è¿Ÿæ—¶é—´
- `STYLES.MARK_UNDERLINE_WIDTH`ï¼šæ ‡è®°ä¸‹åˆ’çº¿å®½åº¦

## API æ¥å£è¯´æ˜

### åç«¯ API æ§åˆ¶å™¨
æ’ä»¶ä½¿ç”¨å¤šä¸ªAPIæ¥å£ï¼Œç”±Java Spring Bootåç«¯æä¾›ï¼š

#### 1. ç¿»è¯‘ API
- **URL**ï¼š`/chrome/crx/translate`
- **æ–¹æ³•**ï¼šGET
- **å‚æ•°**ï¼š
  - `word`ï¼šè¦ç¿»è¯‘çš„è‹±æ–‡å•è¯æˆ–è¯ç»„
- **è¯·æ±‚ç¤ºä¾‹**ï¼š
  ```
  GET /chrome/crx/translate?word=example
  ```
- **è¿”å›æ ¼å¼**ï¼š
  ```json
  {
    "text": "ä¾‹å­"
  }
  ```

#### 2. éŸ³æ ‡ API
- **URL**ï¼š`/chrome/crx/phonetics`
- **æ–¹æ³•**ï¼šGET
- **å‚æ•°**ï¼š
  - `word`ï¼šè¦è·å–éŸ³æ ‡çš„è‹±æ–‡å•è¯
- **è¯·æ±‚ç¤ºä¾‹**ï¼š
  ```
  GET /chrome/crx/phonetics?word=example
  ```
- **è¿”å›æ ¼å¼**ï¼š
  ```json
  {
    "phoneticText": "/ÉªÉ¡ËˆzÉ‘Ëmpl/",
    "audioUrl": "https://example.com/audio.mp3"
  }
  ```

#### 3. å•è¯æœ¬ä¸Šä¼  API
- **URL**ï¼š`/chrome/crx/sync/upload`
- **æ–¹æ³•**ï¼šPOST
- **è¯·æ±‚ä½“**ï¼š
  ```json
  {
    "userId": "ç”¨æˆ·ID",
    "wordbook": [{"word": "example", "translation": "ä¾‹å­", "phonetics": "/ÉªÉ¡ËˆzÉ‘Ëmpl/", "added": 1672531200000, "reviewed": 0}]
  }
  ```
- **è¿”å›æ ¼å¼**ï¼š
  ```json
  {
    "success": true,
    "message": "å•è¯æœ¬ä¸Šä¼ æˆåŠŸ",
    "filePath": "/home/static/file/user123_wordbook.json",
    "wordCount": 1,
    "timestamp": 1767692400000
  }
  ```

#### 4. å•è¯æœ¬ä¸‹è½½ API
- **URL**ï¼š`/chrome/crx/sync/download`
- **æ–¹æ³•**ï¼šGET
- **å‚æ•°**ï¼š
  - `userId`ï¼šç”¨æˆ·ID
- **è¯·æ±‚ç¤ºä¾‹**ï¼š
  ```
  GET /chrome/crx/sync/download?userId=user123
  ```
- **è¿”å›æ ¼å¼**ï¼š
  ```json
  {
    "success": true,
    "message": "å•è¯æœ¬è·å–æˆåŠŸ",
    "wordbook": [{"word": "example", "translation": "ä¾‹å­", "phonetics": "/ÉªÉ¡ËˆzÉ‘Ëmpl/", "added": 1672531200000, "reviewed": 0}],
    "wordCount": 1,
    "timestamp": 1767692400000
  }
  ```

#### 5. å•è¯æœ¬åˆ é™¤ API
- **URL**ï¼š`/chrome/crx/sync/delete`
- **æ–¹æ³•**ï¼šGET
- **å‚æ•°**ï¼š
  - `userId`ï¼šç”¨æˆ·ID
- **è¯·æ±‚ç¤ºä¾‹**ï¼š
  ```
  GET /chrome/crx/sync/delete?userId=user123
  ```
- **è¿”å›æ ¼å¼**ï¼š
  ```json
  {
    "success": true,
    "message": "å•è¯æœ¬åˆ é™¤æˆåŠŸ"
  }
  ```

#### 6. åŒæ­¥ç”¨æˆ·åˆ—è¡¨ API
- **URL**ï¼š`/chrome/crx/sync/list`
- **æ–¹æ³•**ï¼šGET
- **è¿”å›æ ¼å¼**ï¼š
  ```json
  {
    "success": true,
    "users": [{"userId": "user123", "fileName": "user123_wordbook.json", "fileSize": 200, "lastModified": 1767692400000}],
    "total": 1
  }
  ```

## å¼€å‘è€…è¯´æ˜

### æµ‹è¯•æ•°æ®
```javascript
// æµ‹è¯•ç¿»è¯‘APIè¿”å›æ ¼å¼
{
  word: "example",
  translation: "ä¾‹å­",
  phonetic: "/ÉªÉ¡ËˆzÉ‘Ëmpl/",
  added: 1672531200000,
  reviewed: 0
}
```

### æ›¿æ¢ç¿»è¯‘API
ä¿®æ”¹`background.js`ä¸­çš„`handleTranslation`æ–¹æ³•

## ç‰ˆæƒä¿¡æ¯
Â© 2026 è‹±è¯­å­¦ä¹ æ’ä»¶å¼€å‘å›¢é˜Ÿ