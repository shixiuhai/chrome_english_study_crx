# 英语学习助手插件需求文档

## 功能概述
实现Chrome插件在任意网页中标记并学习英语单词/词组的功能，支持多设备同步和现代化UI设计

## 核心功能
1. **单词标记**
   - 鼠标选中文本自动识别单词/词组
   - 自动添加蓝色下划线标记
   - 悬停显示翻译提示框
   - 支持音标显示(英式/美式发音)
   - 先划线后翻译，提升用户体验
   - 300ms延迟确认机制，避免误操作
   - 支持ESC键取消标记
   - 划词时不再自动获取音标，提高划词速度

2. **自动标记**
   - 页面加载时自动标记已保存的所有单词/词组
   - 支持动态加载内容的自动标记
   - 标记一个单词，页面所有相同内容自动标记
   - 取消一个标记，页面所有相同标记自动移除

3. **词组支持** 
   - 支持多单词词组的标记（如"thank you"）
   - 智能识别词组边界
   - 支持词组音标

4. **URL排除**
   - 自动识别并排除URL文本的标记

5. **域名排除功能**
   - 支持排除当前域名，插件将不再在此域名上运行
   - 可管理已排除的域名列表
   - 默认隐藏在高级配置中，减少视觉干扰

6. **数据存储**
   - 本地存储所有标记记录
   - 按单词/词组分类存储
   - 支持音标数据存储
   - 统一配置管理（API路径等）

7. **多端同步**
   - 支持单词本上传到云端
   - 支持从云端下载最新单词本
   - 基于时间戳的版本控制
   - 自动检查最新版本，避免重复更新
   - 支持多设备数据同步一致性
   - API自动重试机制，提高稳定性
   - 用户ID必须为11位数字，建议使用手机号
   - 相同用户ID在不同设备间共享单词本

8. **现代化UI设计**
   - 全新的现代化UI设计
   - 响应式布局，适配不同屏幕尺寸
   - 可折叠的高级配置面板
   - 优化的单词卡片设计
   - 自定义滚动条，提升视觉效果

9. **单词本管理**
   - 查看所有已标记单词和词组
   - 编辑单词翻译和音标
   - 删除不需要的单词
   - 搜索单词功能
   - 自动记录添加/复习时间
   - 单词卡片悬停效果
   - 支持播放单词发音

## 技术实现

### content.js 主要功能
- 实现WordMarker类负责内容标记
- 包含以下核心方法：
  - `initPageMarks()`: 初始化页面标记
  - `setupMutationObserver()`: 监听动态内容
  - `processTextNode()`: 处理文本节点
  - `markExistingWord()`: 标记现有单词
  - `getMarks()`: 获取存储的标记
  - 新增`isUrl()`: 检测URL文本
  - `init()`: 初始化事件监听，包含300ms延迟确认和ESC键取消功能
  - `markWord()`: 标记单词，支持延迟确认机制
  - `markOtherOccurrences()`: 优化版标记其他出现，使用requestAnimationFrame避免阻塞主线程
  - 优化的选区调整逻辑，简化代码结构
  - 防抖机制，避免频繁操作

### 性能优化
- 优化了markOtherOccurrences方法，减少处理节点数量和标记数量
- 使用requestAnimationFrame避免阻塞主线程
- 防抖机制，避免频繁操作
- 简化选区调整逻辑，提高执行效率
- 限制每个单词的最大标记数量为5个
- 限制处理的文本节点数量为50个

### background.js 主要功能
- 数据存储管理(Chrome storage API)
- 消息通信处理
- 单词翻译功能
- 音标获取功能(getPhonetics)，仅在手动请求时调用
- 扩展上下文错误处理，确保稳定性

## API需求
1. 翻译API: /chrome/crx/translate?word=xxx (返回: { "text": "翻译结果" })
2. 音标API: /chrome/crx/phonetics?word=xxx (返回: { "phoneticText": "/音标/", "audioUrl": "音频地址" })

## 测试用例
1. 基础测试
   - 单个单词标记与自动加载
   - 词组标记与自动加载
   - 特殊符号处理（如can't）
   - URL文本识别排除

2. 高级测试
   - 页面刷新后标记保持
   - 滚动加载新内容自动标记
   - 大批量单词标记性能
   - 音标获取与显示功能

## 已知限制
1. 无法标记图片中的文字
2. 复合嵌套结构的文本可能识别不全
3. 极端情况下可能影响页面性能
4. 某些稀有词组的音标可能获取失败

## 版权信息
© 2026 英语学习插件开发团队
